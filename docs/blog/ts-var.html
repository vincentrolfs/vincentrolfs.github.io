







<!DOCTYPE html>
<html lang="en">
  <head>
    <title>The Temporal Dead Zone, or why the TypeScript codebase is littered with var statements</title>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Blog of Vincent Rolfs. Vincent is a freelance Software Engineer and IT-Consultant. He has more than ten years experience in developing complex applications on the web."
    />
    

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:wght@400;900&display=swap"
      rel="stylesheet"
    />
    <link href="/styles/main.css" rel="stylesheet" />

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/img/icons/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/img/icons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/img/icons/favicon-16x16.png"
    />
    <link rel="manifest" href="/img/icons/site.webmanifest" />
    <link
      rel="mask-icon"
      href="/img/icons/safari-pinned-tab.svg"
      color="#80232E"
    />
    <link rel="shortcut icon" href="/img/icons/favicon.ico" />
    <meta name="msapplication-TileColor" content="#b91d47" />
    <meta name="msapplication-config" content="/img/icons/browserconfig.xml" />
    <meta name="theme-color" content="#ffffff" />

    

    <script
      data-goatcounter="https://vincentrolfs.goatcounter.com/count"
      async
      src="//gc.zgo.at/count.js"
    ></script>

    	<link href="/include/prism/prism.css" rel="stylesheet" />
  </head>
  <body>
    <div id="wrapper">
      <div id="caption">
  <div id="caption-wrap">
    <div id="logo">
      <a href="/">
        <img
          src="/img/vincent-circle.png"
          alt="A picture of Vincent Rolfs"
          width="100"
        />
      </a>
    </div>

    <a href="/">
      <h1>Vincent Rolfs</h1>

      <div>Software Engineer</div>
    </a>

    <nav>
      <a
        class=""
        href="/"
      >
        About me
      </a>
      <a
        class=""
        href="/my-work"
      >
        Portfolio</a
      >
      <a
        class=""
        href="/blog"
      >
        Blog
      </a>
      <a
        class=""
        href="/contact"
      >
        Contact
      </a>
    </nav>
  </div>

  <hr />
</div>


      <main>
<h2 class="with-sub">The Temporal Dead Zone, or why the TypeScript codebase is littered with var statements</h2>
<div class="subcaption">
  October 1, 2025
  <span id="viewcount"></span>
</div>

<script>
  "use strict";

  const slug = "ts-var";
  const request = new XMLHttpRequest();

  request.addEventListener("load", function () {
    document.querySelector("#viewcount").innerHTML =
      " &ndash; " + JSON.parse(this.responseText).count + " views";
  });

  request.open(
    "GET",
    "https://vincentrolfs.goatcounter.com/counter/" +
      encodeURIComponent("/blog/" + slug) +
      ".json?" +
      +Date.now()
  );
  
  request.send();
</script>



<p>
  If you have been working with JavaScript for a while, you probably know there
  are a couple of different ways to a initialize a variable. Nowadays we usually
  use
</p>
<pre><code> const password = "hunter2" </code></pre>
<p>and only occasionally, if you need some mutable state:</p>
<pre><code> let password = "hunter2" </code></pre>
<p>
  These declarations have been around for a while and they have reasonable block
  scoping rules:
</p>
<pre><code class="language-js"><span class="token keyword">function</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token parameter">measurement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>calculation<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>anotherCalc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>measurement <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> calculation <span class="token operator">=</span> measurement <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> anotherCalc <span class="token operator">=</span> measurement <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>calculation<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>anotherCalc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
<span class="token punctuation">}</span>
</code></pre>
<p>
  But if you have been working with JS for a <strong>really</strong> long while,
  you might remember the time when neither of these declarations were possible.
  All we had was <code>var</code>. And <code>var</code> stinks. Not only is
  every variable mutable, with no way to enforce immutability, but to make
  matters worse, <code>var</code> leaks beyond block scope:
</p>
<pre><code>function example(measurement) {
  console.log(calculation); // undefined - accessible! calculation leaked out
  console.log(i); // undefined - accessible! i leaked out

  if (measurement > 1) {
    var calculation = measurement + 1;
    // ...
  } else {
    // ...
  }

  console.log(calculation); // 1 - accessible! calculation leaked out

  for (var i = 0; i < 3; i++) {
    // ...
  }

  console.log(i); // 3 - accessible! i leaked out
}
</code></pre>
<p>Terrible!</p>
<p>
  So it was a big surprise to me to find out that the TypeScript codebase (which
  is itself written in TypeScript &mdash; <a href="https://devblogs.microsoft.com/typescript/typescript-native-port/" target="_blank" rel="noopener noreferrer">
  for now
</a>) is <a href="https://github.com/microsoft/TypeScript/blob/968d5deb8b5fd4af3ce85433872bdefc1eb17f10/src/compiler/scanner.ts#L1033" target="_blank" rel="noopener noreferrer">
  littered with var statements like it's 2003
</a>:
</p>
<pre><code>/** @internal */
export function createSourceMapGenerator(
  host: EmitHost,
  file: string,
  sourceRoot: string,
  sourcesDirectoryPath: string,
  generatorOptions: SourceMapGeneratorOptions
): SourceMapGenerator {
  /* eslint-disable no-var */
  var { enter, exit } = generatorOptions.extendedDiagnostics
    ? performance.createTimer("Source Map", "beforeSourcemap", "afterSourcemap")
    : performance.nullTimer;

  // Current source map file and its index in the sources list
  var rawSources: string[] = [];
  var sources: string[] = [];
  var sourceToSourceIndexMap = new Map<string, number>();
  var sourcesContent: (string | null)[] | undefined; // eslint-disable-line no-restricted-syntax

  var names: string[] = [];
  var nameToNameIndexMap: Map<string, number> | undefined;
  var mappingCharCodes: number[] = [];
  var mappings = "";

  // Last recorded and encoded mappings
  var lastGeneratedLine = 0;
  var lastGeneratedCharacter = 0;
  var lastSourceIndex = 0;
  var lastSourceLine = 0;
  var lastSourceCharacter = 0;
  var lastNameIndex = 0;
  var hasLast = false;

  // ... etc
}
</code></pre>
<p>
  The reason has to to with what is called the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let#temporal_dead_zone_tdz" target="_blank" rel="noopener noreferrer">
  Temporal Dead
  Zone (TDZ)
</a>. For each variable in your code, there is a zone where the variable is
  declared but not initialized. The following example makes this clear:
</p>
<pre><code>function example() {
  const result = Math.random() < 0.5 ? useX() : 1; // 50% probability of a ReferenceError
  const x = 10;

  return result;

  function useX() {
    return x;
  }
}
</code></pre>
<p>
  In the above example, it it totally valis to declare <code>g</code> at the
  bottom of the function. The trouble comes when you call it before
  <code>x</code> has been initialized - in other words, when the interpreter is
  still in the TDZ of <code>x</code>. The interpreter refuses to let you access
  <code>x</code> and throws an error.
</p>
<p>
  And that is great! Because if you would use <code>var</code> instead of
  <code>const</code> in this example, there would be no error and the function
  would simply return undefined!
</p>
<pre><code>function example() {
  var result = useX(); // undefined
  var x = 10;

  return result; // undefined

  function useX() {
    return x;
  }
}

console.log(example()); // undefined
</code></pre>
<p>Terrible!</p>
<p>
  So the TDZ is actually a super useful feature brought on by
  <code>const</code> and <code>let</code>. So why doesn't TypeScript want to use
  it? It's because <em>Performance</em>.
</p>
<p>
  Figuring out whether it is in a variable's TDZ is a lot of work for the
  interpreter. As you can see above, it cannot be done statically, but depends
  on nondeterministic runtime behaviour. That brings a penalty which was
  significant for the TypeScript codebase. After migrating a decent amount of
  their statements to <code>var</code>, <a href="https://github.com/microsoft/TypeScript/issues/52924" target="_blank" rel="noopener noreferrer">
  they saw an 8%
  performance improvement across some benchmarks
</a>.
</p>
<p>
  I for one am very happy that I don't have to use <code>var</code> anymore. And
  for TypeScript, I'm sure it's just another reason to <a href="https://devblogs.microsoft.com/typescript/typescript-native-port/" target="_blank" rel="noopener noreferrer">
  migrate their codebase to Go
</a>.
</p>


<div class="divider">
  <hr />
</div>

<p>
  Discuss this article on
  <a href="" target="_blank" rel="noopener">Reddit</a>
  or
  <a href="" target="_blank" rel="noopener"
    >Hacker News</a
  >.
</p>

<p>
  Feel free to email me at
  <a href="mailto:mail@vincentrolfs.dev">mail@vincentrolfs.dev</a>. Or you can
  follow me on Mastodon at
  <a href="https://hachyderm.io/@vincentrolfs" target="_blank" rel="noopener"
    >@vincentrolfs@hachyderm.io</a
  >.
</p>
</main>
    </div>
  </body>
</html>


