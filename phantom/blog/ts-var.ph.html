<script data-phantom>
  async () => {
    $.externalLink = (text, href) =>
      $include("../core/components/externalLink.html", { text, href }).then(
        (it) => it.trim()
      );
    const Prism = (await import("prismjs")).default;
    $.code = (src) =>
      $include(src)
        .then((it) =>
          Prism.highlight(it, Prism.languages.javascript, "javascript")
        )
        .then((it) => `<pre><code class="language-js">${it}</code></pre>`);
  };
</script>

{{ $slot("content") }}
<p>
  If you have been working with JavaScript for a while, you probably know there
  are a couple of different ways to a initialize a variable. Nowadays we usually
  use
</p>
<pre><code> const password = "hunter2" </code></pre>
<p>and only occasionally, if you need some mutable state:</p>
<pre><code> let password = "hunter2" </code></pre>
<p>
  These declarations have been around for a while and they have reasonable block
  scoping rules:
</p>
{{ $.code("assets/ts-var/scoping-good.js") }}
<p>
  But if you have been working with JS for a <strong>really</strong> long while,
  you might remember the time when neither of these declarations were possible.
  All we had was <code>var</code>. And <code>var</code> stinks. Not only is
  every variable mutable, with no way to enforce immutability, but to make
  matters worse, <code>var</code> leaks beyond block scope:
</p>
<pre><code>{{ $include("assets/ts-var/scoping-bad.js") }}</code></pre>
<p>Terrible!</p>
<p>
  So it was a big surprise to me to find out that the TypeScript codebase (which
  is itself written in TypeScript &mdash; {{ $.externalLink(`for now`,
  `https://devblogs.microsoft.com/typescript/typescript-native-port/`) }}) is {{
  $.externalLink(`littered with var statements like it's 2003`,
  `https://github.com/microsoft/TypeScript/blob/968d5deb8b5fd4af3ce85433872bdefc1eb17f10/src/compiler/scanner.ts#L1033`)
  }}:
</p>
<pre><code>{{ $include("assets/ts-var/ts-codebase.ts") }}</code></pre>
<p>
  The reason has to to with what is called the {{ $.externalLink(`Temporal Dead
  Zone (TDZ)`,
  `https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let#temporal_dead_zone_tdz`)
  }}. For each variable in your code, there is a zone where the variable is
  declared but not initialized. The following example makes this clear:
</p>
<pre><code>{{ $include("assets/ts-var/tdz.js") }}</code></pre>
<p>
  In the above example, it it totally valis to declare <code>g</code> at the
  bottom of the function. The trouble comes when you call it before
  <code>x</code> has been initialized - in other words, when the interpreter is
  still in the TDZ of <code>x</code>. The interpreter refuses to let you access
  <code>x</code> and throws an error.
</p>
<p>
  And that is great! Because if you would use <code>var</code> instead of
  <code>const</code> in this example, there would be no error and the function
  would simply return undefined!
</p>
<pre><code>{{ $include("assets/ts-var/no-tdz.js") }}</code></pre>
<p>Terrible!</p>
<p>
  So the TDZ is actually a super useful feature brought on by
  <code>const</code> and <code>let</code>. So why doesn't TypeScript want to use
  it? It's because <em>Performance</em>.
</p>
<p>
  Figuring out whether it is in a variable's TDZ is a lot of work for the
  interpreter. As you can see above, it cannot be done statically, but depends
  on nondeterministic runtime behaviour. That brings a penalty which was
  significant for the TypeScript codebase. After migrating a decent amount of
  their statements to <code>var</code>, {{ $.externalLink(`they saw an 8%
  performance improvement across some benchmarks`,
  `https://github.com/microsoft/TypeScript/issues/52924`) }}.
</p>
<p>
  I for one am very happy that I don't have to use <code>var</code> anymore. And
  for TypeScript, I'm sure it's just another reason to {{
  $.externalLink(`migrate their codebase to Go`,
  `https://devblogs.microsoft.com/typescript/typescript-native-port/`) }}.
</p>
{{ $endSlot() }}

<script data-phantom>
  $include("components/blogPost.html", {
    title:
      "The Temporal Dead Zone, or why the TypeScript codebase is littered with var statements",
    date: "2025-10-01",
    slug: "ts-var",
    order: 2,
    prism: true,
    links: {
      // reddit:
      //   "https://www.reddit.com/r/programming/comments/yznwbh/the_word_sprint_in_agile_development_an/",
      // hackerNews: "https://news.ycombinator.com/item?id=33675469",
    },
    content: $slots.content,
    callback: $props.callback,
  });
</script>
