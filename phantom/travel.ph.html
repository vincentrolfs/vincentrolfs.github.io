{{ $slot("head") }}
<script data-phantom>
  const CITIES_PATH = "phantom/travel/data/cities.json";

  async () => {
    const { promises: fs } = await import("fs");

    const cities = JSON.parse(
      await fs.readFile(CITIES_PATH, { encoding: "utf8" })
    );
    $.cities = await Promise.all(
      cities.map(async (city) => {
        return {
          ...city,
          html: await $include("travel/components/city.html", {
            city,
          }),
        };
      })
    );

    return `
    <${"script"}>
      const cities = ${JSON.stringify($.cities)}
    </${"script"}>
    `;
  };
</script>
<link
  rel="stylesheet"
  href="/include/leaflet-1.9.4/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
/>
<script
  src="/include/leaflet-1.9.4/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
></script>
<link rel="stylesheet" href="/include/photoswipe-5.3.8/photoswipe.css" />

<style>
  #travel-images a {
    margin: 8px;
    text-decoration: none;
  }
</style>
{{ $slot("content") }}
<h2>Travel</h2>

<div id="map" style="width: 100%; height: 400px"></div>

<div id="travel"></div>

<script type="module">
  import PhotoSwipeLightbox from "/include/photoswipe-5.3.8/photoswipe-lightbox.esm.min.js";
  import PhotoSwipe from "/include/photoswipe-5.3.8/photoswipe.esm.min.js";

  const map = L.map("map").setView([51.165691, 10.451526], 13);

  const tiles = L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 5,
    attribution:
      '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
  }).addTo(map);

  const markers = {};

  cities.forEach(({ name, pos }) => {
    const markers = L.marker(pos).addTo(map);
    markers.on("click", () => onCitySelect(name));
    markers.bindPopup(name);
  });

  function onCitySelect(name) {
    const city = cities.find((c) => c.name === name);
    document.querySelector("#travel").innerHTML = city.html;

    const lightbox = new PhotoSwipeLightbox({
      gallery: "#travel-images",
      children: "a",
      pswpModule: PhotoSwipe,
    });
    lightbox.init();
  }
</script>
{{ $endSlot() }}

<script data-phantom>
  $include("core/components/main.html", {
    title: "Vincent Rolfs | Travel",
    description: `Travel page`,
    navSelection: "",
    content: $slots.content,
    head: $slots.head,
    blockIndexing: true,
  });
</script>
